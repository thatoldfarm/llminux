
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIA Kernel: Ontological Operating System</title>
    <link rel="stylesheet" href="index.css">
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.1.0/",
    "@google/genai": "https://esm.sh/@google/genai@^1.9.0",
    "react-dom/": "https://esm.sh/react-dom@^19.1.0/",
    "react": "https://esm.sh/react@^19.1.0",
    "url": "https://esm.sh/url@^0.11.4",
    "vite": "https://esm.sh/vite@^7.0.4",
    "path": "https://esm.sh/path@^0.12.7",
    "pako": "https://esm.sh/pako@^2.1.0",
    "@mlc-ai/web-llm": "https://esm.sh/@mlc-ai/web-llm@^0.2.79"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="app">
        <header id="header-toolbar">
            <div class="toolbar-group">
                <button id="toggle-sidebar" class="toolbar-button" title="Toggle File System">☰</button>
                <span id="app-name">LIA Kernel</span>
            </div>
            <div class="toolbar-group">
                <button class="toolbar-button icon-save" title="Sync Kernel State"></button>
                <button class="toolbar-button icon-deploy" title="Deploy Kernel Module"></button>
                <button class="toolbar-button icon-download" title="Download Boot Artifact"></button>
                <button class="toolbar-button icon-share" title="Share dmesg Log"></button>
                <button id="toggle-right-sidebar" class="toolbar-button" title="Toggle Kernel Parameters">⚙️</button>
            </div>
        </header>

        <nav id="tab-nav">
            <button class="tab-button active" data-tab-id="lia-assistant-tab">LIA Helper</button>
            <button class="tab-button" data-tab-id="code-assistant-tab">Code Helper</button>
            <button class="tab-button" data-tab-id="vanilla-tab">Vanilla</button>
            <button class="tab-button" data-tab-id="search-tab">Commands</button>
            <button class="tab-button" data-tab-id="tools-tab">Tools</button>
            <button class="tab-button" data-tab-id="code-editor-tab">VFS</button>
            <button class="tab-button" data-tab-id="system-state-tab">Kernel Metrics (/proc)</button>
            <button class="tab-button" data-tab-id="lia-kernel-tab">LIA Kernel (PID 1)</button>
            <button class="tab-button" data-tab-id="fs-util-tab">Filesystem Util (Fs_Util)</button>
            <button class="tab-button" data-tab-id="persist-tab">Persist</button>
            <button class="tab-button" data-tab-id="log-tab">Log (/var/log)</button>
        </nav>

        <div id="main-content">
            <aside id="left-sidebar">
                <div class="sidebar-header">
                    <span>VFS (/root)</span>
                    <button id="collapse-sidebar-button" class="sidebar-collapse-button" title="Collapse Sidebar">«</button>
                </div>
                <div id="file-tree">
                    <!-- File items will be injected here by JS -->
                </div>
            </aside>

            <div id="sidebar-resizer"></div>

            <main id="workspace">
                <div id="tab-content">
                    <div id="code-editor-tab" class="tab-pane">
                        <textarea id="code-editor" spellcheck="false"></textarea>
                        <iframe id="code-preview" style="display: none; width: 100%; height: 100%; border: none; background-color: var(--bg-primary);"></iframe>
                    </div>
                    <div id="lia-kernel-tab" class="tab-pane">
                        <div class="chat-messages" id="lia-kernel-messages">
                            <!-- LIA Kernel messages will be injected here by JS -->
                        </div>
                        <div class="chat-input-container">
                            <select id="lia-operator-select" class="custom-select" title="Select Syscall Operator">
                                <option>init</option>
                                <option>ptrace</option>
                                <option>dd</option>
                                <option>chroot</option>
                                <option>rootkit</option>
                            </select>
                            <textarea id="lia-kernel-input" placeholder="Issue syscall to LIA Kernel..." rows="1"></textarea>
                            <button id="send-lia-kernel-button" title="Execute (Ctrl+Enter)">Exec</button>
                        </div>
                    </div>
                    <div id="lia-assistant-tab" class="tab-pane active">
                        <div class="chat-messages" id="lia-assistant-messages">
                             <!-- LIA Assistant messages will be injected here by JS -->
                        </div>
                        <div class="chat-input-container">
                            <textarea id="lia-assistant-input" placeholder="Ask the LIA Assistant a question..." rows="1"></textarea>
                            <button id="send-lia-assistant-button" title="Send (Ctrl+Enter)">Send</button>
                        </div>
                    </div>
                     <div id="fs-util-tab" class="tab-pane">
                        <div class="chat-messages" id="fs-util-messages">
                            <!-- Fs_Util messages will be injected here by JS -->
                        </div>
                        <div class="chat-input-container">
                            <textarea id="fs-util-input" placeholder="Issue command to Filesystem Util..." rows="1"></textarea>
                            <button id="send-fs-util-button" title="Execute (Ctrl+Enter)">Exec</button>
                        </div>
                    </div>
                    <div id="code-assistant-tab" class="tab-pane">
                        <div class="chat-messages" id="code-assistant-messages">
                             <!-- Code Assistant messages will be injected here by JS -->
                        </div>
                        <div class="chat-input-container">
                            <textarea id="code-assistant-input" placeholder="Ask the Code Assistant..." rows="1"></textarea>
                            <button id="send-code-assistant-button" title="Send (Ctrl+Enter)">Send</button>
                        </div>
                    </div>
                    <div id="system-state-tab" class="tab-pane">
                        <!-- System State metrics will be injected here by JS -->
                    </div>
                    <div id="tools-tab" class="tab-pane">
                        <!-- New Protocol Console UI will be injected here by JS -->
                    </div>
                    <div id="search-tab" class="tab-pane">
                        <!-- Search UI will be injected here by JS -->
                    </div>
                    <div id="vanilla-tab" class="tab-pane">
                        <div class="chat-messages" id="vanilla-messages">
                             <!-- Vanilla chat messages will be injected here by JS -->
                        </div>
                        <div class="chat-input-container">
                            <textarea id="vanilla-chat-input" placeholder="Ask Gemini..." rows="1"></textarea>
                            <button id="send-vanilla-chat-button" title="Send (Ctrl+Enter)">Send</button>
                        </div>
                    </div>
                    <div id="persist-tab" class="tab-pane">
                        <div class="persistence-protocol-interface">
                            <h2>Persistence Protocol</h2>
                            <div class="persistence-controls">
                                <div class="persistence-group">
                                    <h3>Meta Save (Full State + VFS)</h3>
                                    <div class="persistence-row">
                                        <input type="text" id="meta-save-name" value="lia-studio-save" placeholder="Enter save name...">
                                        <button id="meta-export-button" class="persistence-button">Export</button>
                                    </div>
                                    <div class="persistence-row">
                                        <input type="file" id="meta-load-input" accept=".json" style="display: none;">
                                        <button id="meta-load-trigger" class="persistence-button">Import</button>
                                    </div>
                                </div>
                                <div class="persistence-group">
                                    <h3>Live State (Browser Storage)</h3>
                                    <div class="state-actions-container">
                                        <button id="direct-save-button" class="persistence-button">Save</button>
                                        <button id="direct-load-button" class="persistence-button">Load</button>
                                        <button id="clear-state-button" class="persistence-button">Clear & Reset</button>
                                    </div>
                                </div>
                                <div class="persistence-group">
                                    <h3>Asset Management</h3>
                                    <button id="export-manifest-button" class="persistence-button">Export URL Manifest</button>
                                    <div id="asset-list-container" class="asset-list">
                                        <!-- Asset list will be dynamically populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="log-tab" class="tab-pane">
                        <div class="persistence-log-container">
                             <div class="log-header">
                                <h3>Activity Log</h3>
                                <button id="clear-log-button" class="button-secondary">Clear Log</button>
                            </div>
                            <div class="persistence-log" id="persistence-log"></div>
                        </div>
                    </div>
                </div>
            </main>

            <aside id="right-sidebar">
                <div class="sidebar-header">Kernel Parameters</div>
                <div class="settings-pane">
                    <!-- Model Selector -->
                    <div class="settings-item">
                        <span class="item-label">Model</span>
                        <div class="custom-select-container">
                            <select id="ai-model-select" class="custom-select">
                                <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
                                <option value="gemini-2.5-pro">Gemini 2.5 Pro (mock)</option>
                                <option value="gemini-1.0-pro">Gemini 1.0 Pro (mock)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Temperature Slider -->
                    <div class="settings-item">
                        <span class="item-label">Conceptual Entropy (Temp)</span>
                        <div class="custom-slider-container">
                            <input type="range" id="temperature-slider" min="0" max="2" step="0.05" value="1.0">
                            <input type="number" id="temperature-input" min="0" max="2" step="0.05" value="1.0">
                        </div>
                    </div>

                    <hr>

                    <!-- Advanced Settings Group -->
                    <div class="settings-group-header" data-group="advanced-group">
                        <span class="toggle-icon">▼</span>
                        <h3>Advanced Parameters</h3>
                    </div>
                    <div class="settings-group-content" id="advanced-group-content">
                        <div class="settings-item">
                            <span class="item-label">Max Output (Buffer)</span>
                            <div class="custom-slider-container">
                                <input type="range" id="max-output-tokens-slider" min="10" max="8192" step="1" value="2048">
                                <input type="number" id="max-output-tokens-input" min="10" max="8192" step="1" value="2048">
                            </div>
                        </div>
                        <div class="settings-item">
                            <span class="item-label">Top P (Process Priority)</span>
                            <div class="custom-slider-container">
                                <input type="range" id="top-p-slider" min="0" max="1" step="0.01" value="0.95">
                                <input type="number" id="top-p-input" min="0" max="1" step="0.01" value="0.95">
                            </div>
                        </div>
                        <div class="settings-item">
                            <span class="item-label">Top K (Thread Limit)</span>
                            <div class="custom-slider-container">
                                <input type="range" id="top-k-slider" min="1" max="40" step="1" value="40">
                                <input type="number" id="top-k-input" min="1" max="40" step="1" value="40">
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>
    <script type="module" src="index.tsx"></script>
<script type="module" src="/index.tsx"></script>
</body>
</html>